<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>添加商品 - 电商管理系统</title>
<base th:href="@{/}">
<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
<link rel="stylesheet" th:href="@{/css/ruoyi-admin.css}" />
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/common.js}"></script>
</head>
<body>
	<div th:replace="admin/header::myheader"></div>
	
	<div class="main-content">
		<div class="page-container">
			<div class="page-header">
				<h1 class="page-title">添加商品</h1>
			</div>
			
			<div class="card">
				<div class="card-body">
					<form th:action="@{/goods/addGoods}" method="post" 
						  th:object="${goods}" enctype="multipart/form-data" 
						  style="max-width: 700px; margin: 0 auto;" onsubmit="return validateForm()">
						  
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品名称</label>
							<input type="text" class="form-control" th:field="*{gname}"
								   placeholder="请输入商品名称" required="required"/>
							<small class="form-text text-muted">商品名称不能为空</small>
						</div>
						
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品原价</label>
							<div style="position: relative;">
								<input type="number" class="form-control" th:field="*{goprice}" 
									   placeholder="0.00" step="0.01" min="0" required="required"
									   style="padding-right: 35px;"/>
								<span style="position: absolute; right: 12px; top: 8px; color: #909399;">元</span>
							</div>
						</div>
						
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品折扣价</label>
							<div style="position: relative;">
								<input type="number" class="form-control" th:field="*{grprice}"
									   placeholder="0.00" step="0.01" min="0" required="required"
									   style="padding-right: 35px;"/>
								<span style="position: absolute; right: 12px; top: 8px; color: #909399;">元</span>
							</div>
							<small class="form-text text-muted">折扣价应小于或等于原价</small>
						</div>
						
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品库存</label>
							<input type="number" class="form-control" th:field="*{stock}"
								   placeholder="请输入库存数量" min="0" required="required"/>
						</div>
						
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品图片</label>
							<div class="file-upload-wrapper">
								<input type="file" id="fileName" name="fileName" class="file-upload-input" 
									   accept="image/jpeg,image/png,image/jpg" onchange="handleFilePreview(this)"/>
								<label for="fileName" class="file-upload-label">
									<span class="file-upload-text">选择图片</span>
								</label>
							</div>
							<div id="imagePreview" style="margin-top: 10px; display: none;">
								<img id="previewImg" style="max-width: 200px; max-height: 200px; border-radius: 4px; border: 1px solid #dcdfe6;"/>
							</div>
							<small class="form-text text-muted">支持 JPG、PNG 格式，建议尺寸 800x800，大小不超过 5MB</small>
						</div>
						
						<div class="form-group">
							<label class="form-label">商品状态</label>
							<div style="padding-top: 8px;">
								<label style="margin-right: 20px; cursor: pointer; font-weight: normal;">
									<input type="radio" th:field="*{status}" value="1" checked style="margin-right: 5px;"/>
									<span style="color: #67c23a;">上架</span>
								</label>
								<label style="cursor: pointer; font-weight: normal;">
									<input type="radio" th:field="*{status}" value="0" style="margin-right: 5px;"/>
									<span style="color: #909399;">下架</span>
								</label>
							</div>
						</div>
						
						<div class="form-group">
							<label class="form-label"><span style="color: #f56c6c;">* </span>商品类型</label>
							<select class="form-control" name="goodstype_id" required="required">
								<option value="" disabled selected>请选择商品类型</option>
								<option th:each="gty:${goodsType}" th:value="${gty.id}" th:text="${gty.typename}"></option>
							</select>
						</div>
						
						<div class="form-group" style="margin-top: 30px; text-align: center;">
							<button type="submit" class="btn-custom btn-primary" style="width: 120px; margin-right: 10px;">添加商品</button>
							<button type="reset" class="btn-custom btn-info" style="width: 120px;">重置</button>
						</div>
					</form>
					
					<script>
					function validateForm() {
						var goprice = parseFloat(document.querySelector('input[name="goprice"]').value);
						var grprice = parseFloat(document.querySelector('input[name="grprice"]').value);
						
						if (grprice > goprice) {
							showToast('折扣价不能大于原价', 'error');
							return false;
						}
						
						var fileInput = document.getElementById('fileName');
						if (!fileInput.files || fileInput.files.length === 0) {
							showToast('请选择商品图片', 'warning');
							return false;
						}
						
						showLoading();
						return true;
					}
					</script>
				</div>
			</div>
		</div>
	</div>
</body>
</html>