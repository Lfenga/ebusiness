<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8"/>
<title>管理员操作日志</title>
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
<link th:href="@{/css/ruoyi-admin.css}" rel="stylesheet"/>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/common.js}"></script>
</head>
<body>
<div th:replace="admin/header::myheader"></div>
<div class="main-content">
	<div class="page-container">
		<div class="page-header">
			<h1 class="page-title">📋 管理员操作日志</h1>
		</div>
		<div>
			<!-- 查询条件表单 -->
			<form class="search-form" method="get" th:action="@{/adminLog/selectLogs}">
				<div class="search-form-item">
					<label class="search-form-label">管理员ID</label>
					<input type="number" name="adminId" class="search-form-input" th:value="${adminId}" placeholder="请输入管理员ID"/>
				</div>
				<div class="search-form-item">
					<label class="search-form-label">模块</label>
					<select name="module" class="search-form-select">
						<option value="">全部</option>
						<option value="商品管理" th:selected="${module == '商品管理'}">商品管理</option>
						<option value="商品类型管理" th:selected="${module == '商品类型管理'}">商品类型管理</option>
						<option value="用户管理" th:selected="${module == '用户管理'}">用户管理</option>
						<option value="订单管理" th:selected="${module == '订单管理'}">订单管理</option>
						<option value="日志管理" th:selected="${module == '日志管理'}">日志管理</option>
						<option value="系统管理" th:selected="${module == '系统管理'}">系统管理</option>
					</select>
				</div>
				<div class="search-form-item">
					<label class="search-form-label">操作类型</label>
					<select name="operationType" class="search-form-select">
						<option value="">全部</option>
						<option value="ADD" th:selected="${operationType == 'ADD'}">添加</option>
						<option value="UPDATE" th:selected="${operationType == 'UPDATE'}">修改</option>
						<option value="DELETE" th:selected="${operationType == 'DELETE'}">删除</option>
					</select>
				</div>
				<div class="search-form-item">
					<label class="search-form-label">状态</label>
					<select name="status" class="search-form-select">
						<option value="">全部</option>
						<option value="SUCCESS" th:selected="${status == 'SUCCESS'}">成功</option>
						<option value="FAIL" th:selected="${status == 'FAIL'}">失败</option>
					</select>
				</div>
				<div class="search-form-item">
					<label class="search-form-label">开始时间</label>
					<input type="date" name="startTime" class="search-form-input" 
					       th:value="${startTime != null ? #dates.format(startTime, 'yyyy-MM-dd') : ''}"/>
				</div>
				<div class="search-form-item">
					<label class="search-form-label">结束时间</label>
					<input type="date" name="endTime" class="search-form-input"
					       th:value="${endTime != null ? #dates.format(endTime, 'yyyy-MM-dd') : ''}"/>
				</div>
				<div class="search-form-item">
					<button type="submit" class="btn-custom btn-primary">🔍 查询</button>
					<a th:href="@{/adminLog/selectLogs}" class="btn-custom btn-info">🔄 重置</a>
				</div>
			</form>
			</div>
			</div>
			
			<!-- 统计信息 -->
			<div class="action-buttons">
				<div></div>
				<div>
					<span style="color: #909399;">共找到 <strong th:text="${totalCount}">0</strong> 条记录</span>
				</div>
			</div>
			
			<!-- 日志列表表格 -->
			<div class="table-wrapper">
			<table class="custom-table">
				<thead>
					<tr class="info">
						<th>日志ID</th>
						<th>管理员</th>
						<th>真实姓名</th>
						<th>模块</th>
						<th>操作类型</th>
						<th>操作描述</th>
						<th>目标类型</th>
						<th>目标ID</th>
						<th>IP地址</th>
						<th>浏览器</th>
						<th>操作时间</th>
						<th>耗时(ms)</th>
						<th>状态</th>
						<th>错误信息</th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${#lists.isEmpty(logs)}">
						<td colspan="11" class="text-center">
							<div class="empty-state">
								<div class="empty-state-icon">📋</div>
								<div class="empty-state-text">暂无日志记录</div>
							</div>
						</td>
					</tr>
					<tr th:each="log : ${logs}">
						<td th:text="${log.id}">1</td>
						<td th:text="${log.adminName}">admin</td>
						<td th:text="${log.adminRealname}">管理员</td>
						<td th:text="${log.module}">商品管理</td>
						<td class="text-center">
							<span th:if="${log.operationType == 'ADD'}" class="status-badge status-badge-success" th:text="${log.operationType}">ADD</span>
							<span th:if="${log.operationType == 'UPDATE'}" class="status-badge status-badge-warning" th:text="${log.operationType}">UPDATE</span>
							<span th:if="${log.operationType == 'DELETE'}" class="status-badge status-badge-danger" th:text="${log.operationType}">DELETE</span>
							<span th:if="${log.operationType == 'QUERY'}" class="status-badge status-badge-info" th:text="${log.operationType}">QUERY</span>
						</td>
						<td th:text="${log.operationDesc}">添加商品</td>
						<td th:text="${log.targetType}">Goods</td>
						<td th:text="${log.targetId}">100</td>
						<td th:text="${log.ipAddress}">127.0.0.1</td>
						<td th:text="${log.browserInfo}">Chrome</td>
						<td th:text="${#dates.format(log.operationTime, 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 12:00:00</td>
						<td th:text="${log.executionTime}">150</td>
						<td class="text-center">
							<span th:class="${log.status == 'SUCCESS' ? 'status-badge status-badge-success' : 'status-badge status-badge-danger'}" 
								th:text="${log.status == 'SUCCESS' ? '成功' : '失败'}"></span>
						</td>
						<td>
							<span th:if="${log.errorMsg != null and log.errorMsg != ''}" 
							      th:title="${log.errorMsg}" 
							      style="cursor: pointer; color: red;">
								<span th:text="${#strings.length(log.errorMsg) > 20 ? #strings.substring(log.errorMsg, 0, 20) + '...' : log.errorMsg}"></span>
							</span>
							<span th:if="${log.errorMsg == null or log.errorMsg == ''}">-</span>
						</td>
					</tr>
				</tbody>
			</table>
			</div>
			
			<!-- 分页导航 -->
			<div class="pagination-container">
				<ul class="pagination">
					<li th:class="${currentPage == 1 ? 'disabled' : ''}">
						<a th:href="@{/adminLog/selectLogs(currentPage=${currentPage - 1}, adminId=${adminId}, module=${module}, operationType=${operationType}, status=${status}, startTime=${startTime}, endTime=${endTime})}" 
						   aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
					<li th:each="i : ${#numbers.sequence(1, totalPage)}" 
					    th:class="${i == currentPage ? 'active' : ''}">
						<a th:href="@{/adminLog/selectLogs(currentPage=${i}, adminId=${adminId}, module=${module}, operationType=${operationType}, status=${status}, startTime=${startTime}, endTime=${endTime})}" 
						   th:text="${i}">1</a>
					</li>
					<li th:class="${currentPage == totalPage ? 'disabled' : ''}">
						<a th:href="@{/adminLog/selectLogs(currentPage=${currentPage + 1}, adminId=${adminId}, module=${module}, operationType=${operationType}, status=${status}, startTime=${startTime}, endTime=${endTime})}" 
						   aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
</body>
</html>
