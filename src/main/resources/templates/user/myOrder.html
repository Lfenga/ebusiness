<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<base th:href="@{/}">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„è®¢å• - eBusiness</title>
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/custom.css" />
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/common.js"></script>
<script type="text/javascript" th:inline="javascript">
	function payOrder(orderId){
		// å…ˆæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
		if (typeof window.showConfirm === 'function') {
			window.showConfirm({
				title: 'ç¡®è®¤æ”¯ä»˜è®¢å•',
				message: 'è®¢å•ç¼–å·ï¼š' + orderId + '<br/>ç¡®è®¤è¦æ”¯ä»˜è¯¥è®¢å•å—ï¼Ÿ',
				type: 'warning',
				confirmText: 'ç¡®è®¤æ”¯ä»˜',
				cancelText: 'å–æ¶ˆ'
			}).then(function(confirmed) {
				if (confirmed) {
					executePayment(orderId);
				}
			});
		} else {
			// é™çº§å¤„ç†
			if(confirm('ç¡®è®¤æ”¯ä»˜è®¢å• ' + orderId + ' å—ï¼Ÿ')){
				executePayment(orderId);
			}
		}
	}
	
	function executePayment(orderId){
		var pathName=window.document.location.pathname;
		var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);
		
		// æ˜¾ç¤ºå¤„ç†ä¸­æç¤º
		showAlert("æ­£åœ¨å¤„ç†æ”¯ä»˜ï¼Œè¯·ç¨å€™...", "info");
		
		$.ajax({
			url : projectName + '/cart/pay',
			type : 'POST',
			contentType : 'application/json',
			data : JSON.stringify({
				id : parseInt(orderId)
			}),
			success : function(result){
				if(result === 'ok'){
					showAlert("ğŸ’³ æ”¯ä»˜æˆåŠŸï¼è®¢å•å·²å®Œæˆ", "success");
					setTimeout(function() {
						location.reload();
					}, 1800);
				} else {
					showAlert("âŒ æ”¯ä»˜å¤±è´¥ï¼š" + result, "error");
				}
			},
	        error : function(xhr, status, error) {
	            showAlert("âš ï¸ æ”¯ä»˜å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•ï¼", "error");
	            console.error('æ”¯ä»˜é”™è¯¯ï¼š', error);
	        }
		});
	}
	
	function showAlert(message, type) {
		// ä½¿ç”¨å…¨å±€çš„showAlertå‡½æ•°ï¼ˆå·²åœ¨common.jsä¸­å®šä¹‰ï¼‰
		if (typeof window.showAlert === 'function') {
			window.showAlert(message, type);
		} else {
			// å…¼åº•æ–¹æ¡ˆ
			alert(message);
		}
	}
</script>
</head>
<body>
<div th:include="user/header"></div>

<div class="container" style="margin-top: 30px; margin-bottom: 60px;">
	<!-- é¢åŒ…å±‘å¯¼èˆª -->
	<ol class="breadcrumb breadcrumb-custom">
		<li><a th:href="@{/}">é¦–é¡µ</a></li>
		<li class="active">æˆ‘çš„è®¢å•</li>
	</ol>
	
	<div class="panel-custom">
		<div class="panel-heading">
			<h3 class="panel-title">ğŸ“¦ æˆ‘çš„è®¢å•</h3>
		</div>
		<div class="panel-body">
			<div class="table-responsive">
				<table class="table table-custom">
					<thead>
						<tr>
							<th class="text-center">è®¢å•ç¼–å·</th>
							<th class="text-center">è®¢å•é‡‘é¢</th>
							<th class="text-center">è®¢å•çŠ¶æ€</th>
							<th class="text-center">ä¸‹å•æ—¶é—´</th>
							<th class="text-center">æ“ä½œ</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order:${myOrder}">
							<td class="text-center" style="vertical-align: middle; font-weight: 600;">
								<span th:text="${order.id}"></span>
							</td>
							<td class="text-center" style="vertical-align: middle;">
								<span style="color: #FF6B6B; font-weight: 700; font-size: 18px;">
									Â¥<span th:text="${order.amount}"></span>
								</span>
							</td>
							<td class="text-center" style="vertical-align: middle;">
								<span th:if="${order.status} == 0" class="status-badge status-unpaid">
									ğŸ’° å¾…æ”¯ä»˜
								</span>
								<span th:if="${order.status} == 1" class="status-badge status-paid">
									âœ… å·²æ”¯ä»˜
								</span>
							</td>
							<td class="text-center" style="vertical-align: middle; color: #6C757D;">
								<span th:text="${order.orderdate}"></span>
							</td>
							<td class="text-center" style="vertical-align: middle;">
								<a th:href="'cart/orderDetail?id=' + ${order.id}" 
								   class="btn btn-sm btn-custom-secondary" 
								   target="_blank">
									ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
								</a>
								<button th:if="${order.status} == 0" 
										th:onclick="'payOrder(' + ${order.id} + ')'"
										class="btn btn-sm btn-custom-primary" 
										style="margin-left: 5px;">
									ğŸ’³ å»æ”¯ä»˜
								</button>
							</td>
						</tr>
						<!-- ç©ºçŠ¶æ€æç¤º -->
						<tr th:if="${#lists.isEmpty(myOrder)}">
							<td colspan="5">
							<div class="empty-state">
								<div class="empty-state-icon">ğŸ“¦</div>
								<p class="empty-state-text">æš‚æ— è®¢å•è®°å½•</p>
								<a th:href="@{/}" class="btn btn-custom-primary">å»è´­ç‰©</a>
							</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
</body>
</html>