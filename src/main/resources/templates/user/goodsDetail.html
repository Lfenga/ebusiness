<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<base th:href="@{/}">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å•†å“è¯¦æƒ… - eBusiness</title>
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/custom.css" />
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/common.js"></script>
<script src="js/starfield.js"></script>
<script src="js/particles.js"></script>
<script type="text/javascript" th:inline="javascript">
	function putCart(){
		if(!(/(^[1-9]\d*$)/.test($("#buyNumber").val()))){
			showAlert("è´­ä¹°é‡è¯·è¾“å…¥æ­£æ•´æ•°!", "warning");
			$("#buyNumber").focus();
			return;
		}
		if(parseInt($("#buyNumber").val()) > parseInt($("#stock").text())){
			showAlert("è´­ä¹°é‡è¶…å‡ºåº“å­˜!", "warning");
			$("#buyNumber").focus();
			return;
		}
		
		//è·å–è·¯å¾„
		var pathName=window.document.location.pathname;
		//æˆªå–ï¼Œå¾—åˆ°é¡¹ç›®åç§°
		var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);
		window.location.href = projectName + "/cart/putCart?id=" +  $("#gid").val() + "&buyNumber=" + $("#buyNumber").val();
	}
	
	function showAlert(message, type) {
		// ä½¿ç”¨å…¨å±€çš„showAlertå‡½æ•°ï¼ˆå·²åœ¨common.jsä¸­å®šä¹‰ï¼‰
		if (typeof window.showAlert === 'function') {
			window.showAlert(message, type);
		} else {
			// å…œåº•æ–¹æ¡ˆ
			alert(message);
		}
	}
</script>
</head>
<body>
	<!-- åŠ è½½header.html -->
	<div th:include="user/header"></div>
	
	<div class="container page-transition" style="margin-top: 30px; margin-bottom: 60px;">
		<!-- é¢åŒ…å±‘å¯¼èˆª -->
		<ol class="breadcrumb breadcrumb-custom">
			<li><a href="/eBusiness">é¦–é¡µ</a></li>
			<li><a href="#" th:text="${goods.typename}">åˆ†ç±»</a></li>
			<li class="active" th:text="${goods.gname}">å•†å“è¯¦æƒ…</li>
		</ol>
		
		<!-- å•†å“è¯¦æƒ…å®¹å™¨ -->
		<div class="product-detail-container">
			<div class="row">
				<!-- å•†å“å›¾ç‰‡åŒºåŸŸ -->
				<div class="col-xs-12 col-sm-5 col-md-5">
					<div class="product-detail-image">
						<img th:src="'images/' + ${goods.gpicture}"
							 alt="å•†å“å›¾ç‰‡"
							 class="img-responsive">
					</div>
				</div>
				
				<!-- å•†å“ä¿¡æ¯åŒºåŸŸ -->
				<div class="col-xs-12 col-sm-7 col-md-7">
					<div class="product-detail-info">
						<h2 th:text="${goods.gname}">å•†å“åç§°</h2>
						
						<!-- ä»·æ ¼ä¿¡æ¯ -->
						<div class="info-item" style="background: linear-gradient(135deg, #FFF5F0 0%, #FFE5D9 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(255, 102, 0, 0.1);">
							<div style="display: flex; align-items: baseline; gap: 20px; flex-wrap: wrap;">
								<div>
									<span style="color: var(--text-secondary); font-size: 14px;">ä¿ƒé”€ä»·</span>
									<div class="number-scroll" style="color: var(--primary-color); font-size: 36px; font-weight: 700; line-height: 1; text-shadow: 0 2px 8px rgba(255, 102, 0, 0.2);">
										Â¥<span id="sale-price" th:text="${goods.grprice}">0</span>
									</div>
								</div>
								<div>
									<span style="color: var(--text-secondary); font-size: 14px;">åŸä»·</span>
									<div style="color: var(--text-secondary); font-size: 20px; text-decoration: line-through;">
										Â¥<span th:text="${goods.goprice}">0</span>
									</div>
								</div>
								<div style="margin-left: auto;">
									<span class="badge-sale" style="font-size: 16px; padding: 8px 16px; animation: pulse 2s infinite;">
										ğŸ‰ çœ Â¥<span th:text="${goods.goprice - goods.grprice}">0</span>
									</span>
								</div>
							</div>
						</div>
						
						<!-- å•†å“å±æ€§ -->
						<div class="info-item">
							<span class="info-label">ğŸ·ï¸ å•†å“ç±»å‹ï¼š</span>
							<span class="info-value" style="font-weight: 600;" th:text="${goods.typename}">ç±»å‹</span>
						</div>
						
						<div class="info-item">
							<span class="info-label">ğŸ“¦ åº“å­˜æ•°é‡ï¼š</span>
							<span class="info-value" style="font-weight: 700; color: var(--success-color); font-size: 18px;">
								<span id="stock" th:text="${goods.stock}">0</span> ä»¶
							</span>
						</div>
						
						<!-- è´­ä¹°æ•°é‡ -->
						<div class="info-item">
							<span class="info-label">ğŸ›ï¸ è´­ä¹°æ•°é‡ï¼š</span>
							<div style="display: inline-block;">
								<input type="number" 
									   class="quantity-input" 
									   id="buyNumber" 
									   name="buyNumber"
									   value="1"
									   min="1"
									   placeholder="è¯·è¾“å…¥è´­ä¹°æ•°é‡"
									   style="border: 2px solid var(--border-color); transition: all 0.3s;"
									   onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px rgba(255, 102, 0, 0.1)'"
									   onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'"/>
								<input type="hidden" name="gid" id="gid" th:value="${goods.id}"/>
								<p style="margin-top: 8px; color: var(--text-secondary); font-size: 13px;">
									ğŸ’¡ æç¤ºï¼šè¯·è¾“å…¥1-<span th:text="${goods.stock}"></span>ä¹‹é—´çš„æ•°é‡
								</p>
							</div>
						</div>
						
						<!-- æ“ä½œæŒ‰é’® -->
						<div style="margin-top: 40px; display: flex; gap: 15px; flex-wrap: wrap;">
							<button onclick="putCart()" class="btn btn-custom-primary btn-lg btn-icon">
								<span style="font-size: 18px;">ğŸ›’</span>
								<span>åŠ å…¥è´­ç‰©è½¦</span>
							</button>
							<a href="cart/selectCart" class="btn btn-custom-secondary btn-lg btn-icon">
								<span style="font-size: 18px;">ğŸ‘ï¸</span>
								<span>æŸ¥çœ‹è´­ç‰©è½¦</span>
							</a>
							<a href="/" class="btn btn-default btn-lg">
								ç»§ç»­è´­ç‰©
							</a>
						</div>
						
						<!-- æœåŠ¡ä¿éšœ -->
						<div style="margin-top: 40px; padding: 20px; background: #F8F9FA; border-radius: 12px;">
							<h4 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #2C3E50;">
								âœ… æœåŠ¡ä¿éšœ
							</h4>
							<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
								<div style="color: #6C757D; font-size: 14px;">
									âœ“ æ­£å“ä¿è¯
								</div>
								<div style="color: #6C757D; font-size: 14px;">
									âœ“ 7å¤©æ— ç†ç”±é€€æ¢
								</div>
								<div style="color: #6C757D; font-size: 14px;">
									âœ“ å…¨å›½åŒ…é‚®
								</div>
								<div style="color: #6C757D; font-size: 14px;">
									âœ“ å”®åæ— å¿§
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- å•†å“è¯¦æƒ…æè¿° -->
		<div class="panel-custom" style="margin-top: 30px;">
			<div class="panel-heading">
				<h3 class="panel-title">ğŸ“‹ å•†å“è¯¦æƒ…</h3>
			</div>
			<div class="panel-body">
				<div style="min-height: 200px; line-height: 2; color: #6C757D;">
					<p>è¿™æ˜¯ä¸€æ¬¾ä¼˜è´¨å•†å“ï¼Œè´¨é‡ä¿è¯ï¼Œæ¬¢è¿é€‰è´­ï¼</p>
					<p>æˆ‘ä»¬æ‰¿è¯ºä¸ºæ‚¨æä¾›æœ€ä¼˜è´¨çš„äº§å“å’ŒæœåŠ¡ã€‚</p>
				</div>
			</div>
		</div>
	</div>
	
	<script>
	$(document).ready(function() {
		// ä»·æ ¼æ•°å­—æ»šåŠ¨åŠ¨ç”»
		var priceElement = $('#sale-price');
		if (priceElement.length > 0) {
			var finalPrice = parseFloat(priceElement.text());
			if (!isNaN(finalPrice) && window.particleSystem) {
				window.particleSystem.animateNumber(priceElement[0], 0, finalPrice, 1000);
			}
		}
		
		// å•†å“å›¾ç‰‡æ”¾å¤§é•œæ•ˆæœ
		var $img = $('.product-detail-image img');
		var $container = $('.product-detail-image');
		
		$container.addClass('magnifier-container');
		
		// åˆ›å»ºæ”¾å¤§é•œå…ƒç´ 
		var $glass = $('<div class="magnifier-glass"></div>');
		$container.append($glass);
		
		$container.on('mousemove', function(e) {
			var offset = $(this).offset();
			var x = e.pageX - offset.left;
			var y = e.pageY - offset.top;
			
			// é™åˆ¶åœ¨å®¹å™¨å†…
			var glassSize = 150;
			var halfSize = glassSize / 2;
			x = Math.max(halfSize, Math.min(x, $container.width() - halfSize));
			y = Math.max(halfSize, Math.min(y, $container.height() - halfSize));
			
			$glass.css({
				left: x - halfSize + 'px',
				top: y - halfSize + 'px',
				backgroundImage: 'url(' + $img.attr('src') + ')',
				backgroundSize: ($container.width() * 2) + 'px ' + ($container.height() * 2) + 'px',
				backgroundPosition: '-' + (x * 2 - halfSize) + 'px -' + (y * 2 - halfSize) + 'px'
			});
		});
		

	});
	
	function showAlert(message, type) {
		if (typeof window.showAlert === 'function') {
			window.showAlert(message, type);
		} else {
			alert(message);
		}
	}
	</script>
</body>
</html>